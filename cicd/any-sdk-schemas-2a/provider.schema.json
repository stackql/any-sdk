{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.stackql.io/any-sdk/provider.schema.json",
  "title": "stackql any-sdk provider document",
  "type": "object",
  "required": [
    "name",
    "id",
    "version",
    "protocolType",
    "services"
  ],
  "properties": {
    "name": {
      "type": "string"
    },
    "id": {
      "$ref": "#/$defs/providerId"
    },
    "version": {
      "$ref": "#/$defs/semver"
    },
    "description": {
      "type": "string"
    },
    "homepage": {
      "type": "string"
    },
    "protocolType": {
      "type": "string",
      "enum": [
        "http",
        "local_templated"
      ]
    },
    "auth": {
      "$ref": "#/$defs/authRef"
    },
    "services": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "id",
          "title",
          "version",
          "serviceDocument"
        ],
        "properties": {
          "id": {
            "$ref": "#/$defs/serviceId"
          },
          "title": {
            "type": "string"
          },
          "version": {
            "type": "string"
          },
          "serviceDocument": {
            "type": "string"
          },
          "resourcesDocument": {
            "type": "string"
          }
        },
        "additionalProperties": true
      }
    },
    "x-stackQL-info": {
      "type": "object",
      "additionalProperties": true
    }
  },
  "additionalProperties": true,
  "$defs": {
    "providerId": {
      "type": "string",
      "pattern": "^[a-z0-9.-]+$"
    },
    "semver": {
      "type": "string",
      "pattern": "^v?\\d+\\.\\d+\\.\\d+(-[0-9A-Za-z.-]+)?$"
    },
    "serviceId": {
      "type": "string",
      "pattern": "^[a-z0-9.-]+$"
    },
    "resourceId": {
      "type": "string",
      "pattern": "^[a-z0-9_.-]+$"
    },
    "methodId": {
      "type": "string",
      "pattern": "^[a-z_][a-z0-9_]*$"
    },
    "sqlVerb": {
      "type": "string",
      "enum": [
        "select",
        "insert",
        "update",
        "delete"
      ]
    },
    "evidence": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "source",
          "locator"
        ],
        "properties": {
          "source": {
            "type": "string"
          },
          "locator": {
            "type": "string"
          },
          "quote": {
            "type": "string"
          }
        },
        "additionalProperties": true
      }
    },
    "authRef": {
      "type": "object",
      "oneOf": [
        {
          "properties": {
            "type": {
              "const": "oauth2"
            },
            "scopes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "token_url": {
              "type": "string"
            }
          },
          "required": [
            "type"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "apiKey"
            },
            "in": {
              "type": "string",
              "enum": [
                "header",
                "query"
              ]
            },
            "name": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "in",
            "name"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "sigv4"
            },
            "service": {
              "type": "string"
            },
            "region": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "service"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "aad"
            },
            "resource": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "resource"
          ]
        },
        {
          "properties": {
            "type": {
              "const": "none"
            }
          },
          "required": [
            "type"
          ]
        }
      ]
    },
    "sqlVerbsMap": {
      "type": "object",
      "properties": {
        "select": {
          "$ref": "#/$defs/sqlVerbEntry"
        },
        "insert": {
          "$ref": "#/$defs/sqlVerbEntry"
        },
        "update": {
          "$ref": "#/$defs/sqlVerbEntry"
        },
        "delete": {
          "$ref": "#/$defs/sqlVerbEntry"
        }
      },
      "additionalProperties": false
    },
    "sqlVerbEntry": {
      "type": "object",
      "properties": {
        "operationIds": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "operationIds"
      ],
      "additionalProperties": true
    }
  }
}